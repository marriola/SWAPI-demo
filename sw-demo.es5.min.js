"use strict";var $demo=function(){function e(){$("#table-popup, #overlay").fadeIn()}function t(){$("#table-popup, #overlay").fadeOut()}function n(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],n=e.attr("id").replace("-template","");return t&&$("#"+n).remove(),e.clone().first().attr("id",n)}function r(){return g.resources[g.resourcesView.selected]}function o(e){return e.split("_").map(function(e,t){return e[0].toUpperCase()+e.substr(1)}).join(" ")}function s(e,t){return{name:e,displayName:o(e),index:t}}function a(){$.ajax({type:"GET",url:p,success:function(e){g.resources=Object.keys(e).map(function(e,t){var n=s(e,t);return n.columns=[],n.selected=!1,n}),g.resourcesView.resources=g.resources,new Vue({el:"#resources",data:g.resourcesView,methods:g.resourcesViewMethods}),i()},error:function(){alert("couldn't get resources")}})}function i(){var e=!0,t=!1,n=void 0;try{for(var r,o=function(){var e=r.value;$.ajax({type:"GET",url:p+e.name+"/schema",error:function(){alert("error retrieving schema for '"+e.name+"'")},success:function(e){return function(t){e.columns=Object.keys(t.properties).map(function(e,n){var r=s(e);return r.show=!0,r.hasUrl=t.properties[e].description.toLowerCase().contains("url"),r}),++g.retrievedResources==g.resources.length&&(f.columns=new Vue({el:"#columns",data:{resources:g.resources},methods:g.columnViewMethods}),$("#please-wait").fadeOut(250,function(){$("#controls").fadeIn(250)}),$("#btnGet").prop("disabled",!1))}}(e)})},a=g.resources[Symbol.iterator]();!(e=(r=a.next()).done);e=!0)o()}catch(i){t=!0,n=i}finally{try{!e&&a["return"]&&a["return"]()}finally{if(t)throw n}}}function l(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],t=r(),n=p+t.name+"/?page="+e;$("#spinner").show(),$.ajax({type:"GET",url:n,success:function(e){$("#btnPrev").prop("disabled",!e.previous),$("#btnNext").prop("disabled",!e.next),$("#table").remove(),$("#table-template").clone().first().attr("id","table").show().appendTo($("#rest")),e.page=g.page,g.viewModel=new Vue({el:"#table",data:{pageStart:10*(g.page-1)+1,pageEnd:10*(g.page-1)+e.results.length,count:e.count,resource:t,results:e.results,linkStore:g.linkStore},methods:g.entityViewMethods}),u("#table"),$("#spinner").hide(),$("html, body").animate({scrollTop:0}),$("#table").show()},error:function(e){}})}function c(t,r){var o=void 0,s=t.match(/http:\/\/swapi.co\/api\/(\w+).*/);if(s){o=s[1];var a=g.resources.find(function(e){return e.name==o});if(a){var i=a.columns;$.ajax({type:"GET",url:t,success:function(t){$("#rest").append(n($("#table-popup-template"),!0)),new Vue({el:"#table-popup",data:{columns:i,result:t,linkStore:g.linkStore},methods:g.entityPopupViewMethods}),u("#table-popup"),e(),r&&r()}})}}}function u(){arguments.length<=0||void 0===arguments[0]?null:arguments[0];if(d){var e=$(".not-set"),t=e.length;console.log("Resolving "+t+" links..."),e.each(function(e,n){var r=n.getAttribute("href");return g.waiting[r]?void--t:g.linkStore[r]?($("[href='"+r+"']").text(g.linkStore[r]).removeClass("not-set"),void--t):(g.waiting[r]=!0,void $.ajax({type:"GET",url:r,success:function(e){var n=e.name||e.title;$("[href='"+r+"']").text(n).removeClass("not-set"),g.linkStore[r]=n,--t,0==t&&(localStorage.linkStore=JSON.stringify(g.linkStore),console.log("Done."))}}))})}}String.prototype.contains=String.prototype.contains||function(e){return-1!=this.indexOf(e)};var d=!0,p="http://swapi.co/api/",f={columns:null},m={clickLink:function(e,t,n){n.preventDefault(),n.target.classList.add("waiting"),c(t,function(){n.target.classList.remove("waiting")})},isArray:function(e){return Array.isArray(e)}},g={waiting:{},linkStore:localStorage.linkStore&&JSON.parse(localStorage.linkStore)||{},resourcesView:{selected:"0"},resourcesViewMethods:{selectResource:function(e){$("#table").remove(),$("#btnPrev, #btnNext").prop("disabled",!0),g.page=1}},columnViewMethods:{showColumns:function(e){$(".columnName").removeClass("selected"),$(".columnName[data-index='"+e.index+"']").addClass("selected"),0==$(".columnPage:visible").length?$(".columnPage[data-index='"+e.index+"']").slideDown(250):$(".columnPage:visible").fadeOut(250,function(){$(".columnPage[data-index='"+e.index+"']").fadeIn(250)})}},entityViewMethods:{clickLink:m.clickLink,isArray:m.isArray,showOnMobile:function(e){return"url"==e}},entityPopupViewMethods:{clickLink:m.clickLink,isArray:m.isArray},resourceIndex:0,viewModel:null,prevPage:null,nextPage:null,page:1,resources:[],retrievedResources:0};return $("#btnPrev").on("click",function(e){l(--g.page)}),$("#btnGet").on("click",function(e){l(g.page)}),$("#btnNext").on("click",function(e){l(++g.page)}),$("#columnFilterExpand").on("click",function(e){var t=$("#expandIndicator").hasClass("open");t?($("#expandIndicator").removeClass("open").addClass("closed"),$("#columns").toggle(500)):($("#expandIndicator").removeClass("closed").addClass("open"),$("#columns").toggle(500))}),$("#overlay, #btnClose").on("click",t),a(),{hideOverlay:t}}();