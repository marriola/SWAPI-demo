"use strict";!function(){function e(e){var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],n=e.attr("id").replace("-template","");return t&&$("#"+n).remove(),e.clone().first().attr("id",n)}function t(t){var n=void 0,r=t.match(/http:\/\/swapi.co\/api\/(\w+).*/);if(r){n=r[1];var o=v.resources.find(function(e){return e.originalName==n});if(o){var i=o.columns;$.ajax({type:"GET",url:t,success:function(t){$(document.body).append(e($("#entity-popup-template"),!0)),new Vue({el:"#entity-popup",data:{columns:i,result:t,linkStore:v.linkStore},methods:v.entityPopupViewMethods}),c("#entity-popup"),u()}})}}}function n(){return v.resources[v.resourcesView.selected]}function r(e){return e.split("_").map(function(e,t){return e[0].toUpperCase()+e.substr(1)}).join(" ")}function o(e,t){return{originalName:e,displayName:r(e),index:t}}function i(){$.ajax({type:"GET",url:d,success:function(e){v.resources=Object.keys(e).map(function(e,t){var n=o(e,t);return n.columns=[],n.selected=!1,n}),v.resourcesView.resources=v.resources,new Vue({el:"#resources",data:v.resourcesView,methods:v.resourcesViewMethods}),s()},error:function(){alert("couldn't get resources")}})}function s(){var e=!0,t=!1,n=void 0;try{for(var r,i=function(){var e=r.value;$.ajax({type:"GET",url:d+e.originalName+"/schema",error:function(){alert("error retrieving schema for '"+e.originalName+"'")},success:function(e){return function(t){e.columns=Object.keys(t.properties).map(function(e,n){var r=o(e);return r.show=!0,r.hasUrl=t.properties[e].description.toLowerCase().contains("url"),r}),++v.retrievedResources==v.resources.length&&(m.columns=new Vue({el:"#columns",data:{resources:v.resources},methods:v.columnViewMethods}),$("#columnFilter").show(),$("#btnGet").prop("disabled",!1))}}(e)})},s=v.resources[Symbol.iterator]();!(e=(r=s.next()).done);e=!0)i()}catch(a){t=!0,n=a}finally{try{!e&&s["return"]&&s["return"]()}finally{if(t)throw n}}}function a(){var e=arguments.length<=0||void 0===arguments[0]?"":arguments[0],t=n(),r=d+t.originalName+"/?page="+e;$.ajax({type:"GET",url:r,success:function(e){$("#btnPrev").prop("disabled",!e.previous),$("#btnNext").prop("disabled",!e.next),$("#entity").remove(),$("#entity-template").clone().first().attr("id","entity").show().appendTo($(document.body)),e.page=v.page,v.viewModel=new Vue({el:"#entity",data:{page:v.page,count:e.count,resource:t,results:e.results,linkStore:v.linkStore},methods:v.entityViewMethods}),c("#entity"),$("#entity").show()},error:function(e){}})}function c(){function e(e){var n=e.getAttribute("href");return v.linkStore[n]&&"[click]"!==v.linkStore[n]?void $("[href='"+n+"']").text(v.linkStore[n]).removeAttr("fill-me-in"):void $.ajax({type:"GET",url:n,success:function(e){var r=e.name||e.title;$("[href='"+n+"']").text(r).removeAttr("fill-me-in"),v.linkStore[n]=r;var o=$("[fill-me-in]",t).length;0==o&&(localStorage.linkStore=JSON.stringify(v.linkStore))}})}var t=arguments.length<=0||void 0===arguments[0]?null:arguments[0];p&&$("[fill-me-in]",t).each(function(t,n){var r=n.getAttribute("href");v.linkStore[r]||(v.linkStore[r]="[click]"),e(n)})}function u(){$("#entity-popup, #overlay").fadeIn()}function l(){$("#entity-popup, #overlay").fadeOut()}String.prototype.contains=String.prototype.contains||function(e){return-1!=this.indexOf(e)};var p=!0,d="http://swapi.co/api/",m={columns:null},f={clickLink:function(e,n,r){r.preventDefault(),t(n)},isArray:function(e){return Array.isArray(e)}},v={linkStore:localStorage.linkStore&&JSON.parse(localStorage.linkStore)||{},resourcesView:{selected:"0"},resourcesViewMethods:{selectResource:function(e){$("#entity").remove(),$("#btnPrev, #btnNext").prop("disabled",!0),v.page=1}},columnViewMethods:{showColumns:function(e){$(".columnName").removeClass("selected"),$(".columnName[data-index='"+e.index+"']").addClass("selected"),$(".columnPage").hide(),$(".columnPage[data-index='"+e.index+"']").show()}},entityViewMethods:{clickLink:f.clickLink,isArray:f.isArray},entityPopupViewMethods:{clickLink:f.clickLink,isArray:f.isArray},resourceIndex:0,viewModel:null,prevPage:null,nextPage:null,page:1,resources:[],retrievedResources:0};Vue.filter("getName",function(e){return"[click]"}),$("#btnPrev").on("click",function(e){a(--v.page)}),$("#btnGet").on("click",function(e){a(v.page)}),$("#btnNext").on("click",function(e){a(++v.page)}),$("#columnFilterExpand").on("click",function(e){var t=$("#expandIndicator").hasClass("open");t?($("#expandIndicator").removeClass("open").addClass("closed"),$("#columns").slideUp()):($("#expandIndicator").removeClass("closed").addClass("open"),$("#columns").slideDown())}),$("#overlay").on("click",l),i()}();